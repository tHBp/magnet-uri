<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="Description" content="Convert MyLink Magnet URLs">
    <link rel="shortcut icon" href="./favicon.ico">
    <meta name="theme-color" content="#d2d2d2" />
    <title>Convert MyLink Magnet URLs</title>
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="search" href="https://magnet-uri.netlify.com/opensearch.xml" type="application/opensearchdescription+xml" title="Convert MyLink Magnet URLs" />
</head>


<body>
    <style prop="root-styles">
        html,
        button,
        input {
            font-family: "Raleway", sans-serif;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            overscroll-behavior: none;
        }

        .grow {
            min-height: 100%;
        }

        input:focus,
        button:focus {
            outline: none;
        }

        :root {
            /* Sizes */
            --font-size: 16px;
            --max-width: 200px;

            /* Light theme colors */
            --light-body-background: #f9f9f9;
            --light-text-color: #000;
            --light-button-color-background: #2196f3;
            --light-button-color-foreground: #fff;
            --light-color-switcher-background: #fce100;

            /* Dark theme colors */
            --dark-body-background: #444;
            --dark-text-color: #fff;
            --dark-button-color-background: #222;
            --dark-button-color-foreground: #fff;
            --dark-color-switcher-background: #222;
        }

        .theme-container {
            /* Default light theme */
            --body-background: var(--light-body-background);
            --text-color: var(--light-text-color);
            --button-color-background: var(--light-button-color-background);
            --button-color-foreground: var(--light-button-color-foreground);
            --color-switcher-background: var(--light-color-switcher-background);
        }

        .color-switcher:checked~.theme-container {
            /* Apply dark theme when input is checked */
            --body-background: var(--dark-body-background);
            --text-color: var(--dark-text-color);
            --button-color-background: var(--dark-button-color-background);
            --button-color-foreground: var(--dark-button-color-foreground);
            --color-switcher-background: var(--dark-color-switcher-background);
        }

        .base-colors {
            background-color: var(--body-background);
            color: var(--text-color);
            transition: background-color 1s ease-out, color 0.5s ease-out;
        }

        .input:focus::placeholder {
            opacity: 0;
        }

        .input::placeholder {
            color: #969696;
            opacity: 1;
            transition: opacity 0.5s;
        }

        form {
            display: contents;
        }

        .hide {
            position: absolute;
            overflow: hidden;
            clip: rect(0 0 0 0);
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            border: 0;
            white-space: nowrap;
        }
    </style>
    <style prop="form-context">
        .form {
            display: grid;
            grid-gap: 60px;
            align-content: center;
            margin-top: 40vh;
            padding: 10px;
            font-size: var(--font-size);
            grid-template-columns: auto auto;
            justify-content: center;
        }

        .center {
            text-align: center;
        }

        .form button {
            position: relative;
            display: inline-block;
            box-sizing: border-box;
            border: none;
            border-radius: 4px;
            padding: 0 16px;
            min-width: 64px;
            height: 36px;
            vertical-align: middle;
            text-align: center;
            text-transform: uppercase;
            background-color: var(--button-color-background);
            color: var(--button-color-foreground);
            box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12);
            font-size: var(--font-size);
            overflow: hidden;
            outline: none;
            cursor: pointer;
            transition: box-shadow 0.2s;
        }

        .form button::-moz-focus-inner {
            border: none;
        }

        .form button::before {
            content: "";
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .form button::after {
            content: "";
            position: absolute;
            left: 50%;
            top: 50%;
            border-radius: 50%;
            padding: 50%;
            width: 32px;
            height: 32px;
            background-color: #fff;
            opacity: 0;
            transform: translate(-50%, -50%) scale(1);
            transition: opacity 1s, transform 0.5s;
        }

        .form button:hover,
        .form button:focus {
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.2), 0 4px 5px 0 rgba(0, 0, 0, 0.14), 0 1px 10px 0 rgba(0, 0, 0, 0.12);
        }

        .form button:hover::before {
            opacity: 0.08;
        }

        .form button:focus::before {
            opacity: 0.24;
        }

        .form button:hover:focus::before {
            opacity: 0.3;
        }

        .form button:active {
            box-shadow: 0 5px 5px -3px rgba(0, 0, 0, 0.2), 0 8px 10px 1px rgba(0, 0, 0, 0.14), 0 3px 14px 2px rgba(0, 0, 0, 0.12);
        }

        .form button:active::after {
            opacity: 0.32;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0s;
        }

        .input {
            border: 0;
            outline: 0;
            color: var(--text-color);
            transition: color 0.5s ease-out;
            background: transparent;
            border-bottom: 1px solid #b9b9b9;
            font-size: var(--font-size);
            max-width: var(--max-width);
        }

        .display {
            padding: 2rem;
            margin: auto;
            width: 40vw;
            overflow-wrap: break-word;
            user-select: all;
        }
    </style>
    <style prop="color-switcher">
        .color-mode-toggle {
            padding: 1rem 0;
            margin: 0 calc(100vw - 7rem);
        }

        .switch {
            font-size: 30px;
            position: relative;
            display: inline-block;
            width: 50px;
            height: 30px;
        }

        .switch .color-switcher {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--color-switcher-background);
            transition: 0.4s;
        }

        .slider:before {
            position: absolute;
            content: "ðŸŒž";
            height: 0px;
            width: 0px;
            left: -5px;
            top: 18px;
            line-height: 0px;
            transition: 0.4s;
        }

        .color-switcher:checked+.theme-container .slider:before {
            left: -4px;
            content: "ðŸŒš";
        }

        .color-switcher:checked+.theme-container .slider:before {
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
    </style>
    <style prop="media-queries">
        @media only screen and (max-width: 425px) {
            :root {
                --font-size: 20px;
            }

            body {
                transition: background-color 0.5s ease-out, color 0.2s ease-out;
            }

            .form {
                margin-top: 10vh;
                grid-template-columns: auto;
            }

            .form button {
                grid-column: 1/2;
                font-size: 16px;
            }

            .display {
                width: 75vw;
            }

            .color-mode-toggle {
                padding: 1rem 0;
                margin: 0 calc(100vw - 5rem);
            }

            .slider:before {
                top: 15px;
            }

            .color-switcher:checked+.theme-container .slider:before {
                left: -10px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .base-colors,
            .input,
            .slider,
            .slider::before,
            .form button,
            .form button::before,
            .form button::after,
            .form button:active::after,
            .input::placeholder {
                transition: none;
            }
        }

        /* @media (prefers-color-scheme: dark) {
            .theme-container {
                --body-background: var(--dark-body-background);
                --text-color: var(--dark-text-color);
                --button-color-background: var(--dark-button-color-background);
                --button-color-foreground: var(--dark-button-color-foreground);
                --color-switcher-background: var(--dark-color-switcher-background);
            }
        } */
    </style>
    <input id="color-switcher-input" aria-label="Toggle dark mode" type="checkbox" class="hide color-switcher">
    <div class="theme-container grow base-colors">
        <div class="color-mode-toggle">
            <label for="color-switcher-input" class="switch">
                <span class="slider round"></span>
            </label>
        </div>
        <div class="form">
            <form method="POST" action="/.netlify/functions/parseLink">
                <label class="center" for="url">Enter the URL</label>
                <input name="url" class="center input" autocomplete="off" placeholder="magnet:?" type="url" id="url">
                <button name="getURL" type="submit" class="getURL">Get URL</button>
                <button name="goToURL" type="submit" class="goToURL">Go to URL</button>
            </form>
        </div>
        <div class="center display"></div>
    </div>
    <script>
        document.querySelector(".goToURL").setAttribute("type", "button");
        document.querySelector(".getURL").setAttribute("type", "button");
        const regex = new RegExp(/magnet.*/);
        const rootStyle = document.documentElement.style;

        const getURL = enteredURL => enteredURL.match(regex) ?
            decodeURIComponent(enteredURL.match(regex)[0]) : null;

        const goToURL = improperUrl => {
            const redirectURL = getURL(improperUrl);
            if (redirectURL) {
                return window.location.href = redirectURL;
            }
            document.querySelector(".display").innerText = "Invalid URL";
        };

        const darkModeToggled = isDarkMode => {
            document.querySelector("head > meta[name='theme-color']").setAttribute("content", isDarkMode ?
                "#444" : "#d2d2d2");
            sessionStorage.setItem("darkModePreferred", isDarkMode);
        }

        document.querySelector(".color-switcher")
            .addEventListener("change", ({ target: { checked } }) => darkModeToggled(checked));

        document.querySelector(".getURL").addEventListener("click", () => {
            document.querySelector(".display").innerText = getURL(document.querySelector(".input").value) ||
                "Invalid URL";
        });

        document.querySelector(".goToURL").addEventListener("click", () => {
            goToURL(document.querySelector(".input").value);
        });

        const searchParamsLink = (new URLSearchParams(window.location.search)).get("link");

        if (searchParamsLink) {
            goToURL(searchParamsLink);
        }
    </script>
</body>

</html>